<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spectral Audio Synthesizer (Wavetable Export) v5</title>
    
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <h1 class="main-title">
            Spectral Audio Synthesizer (Wavetable Export) v5
        </h1>
        
        <!-- Main Control Buttons -->
        <div class="button-group">
            <button id="play-button" class="btn btn-play">Start Tone</button>
            <button id="export-wav-button" class="btn btn-export">Export Wavetable (WAV)</button>
            <button id="add-wave-button" class="btn btn-add-wave">Add to Waveforms</button>
        </div>

        <!-- Visualization Canvas -->
        <div id="canvas-container" class="canvas-container">
            <!-- p5.js canvas will be injected here -->
        </div>

        <!-- Main Controls -->
        <div class="control-card">
            <!-- Master Controls Row -->
            <div class="control-row">
                <!-- Master Gain Control -->
                <div class="labeled-control">
                    <label for="master-gain-slider">
                        Master Gain 
                        <span id="master-gain-value">3%</span>
                    </label>
                    <input type="range" id="master-gain-slider" class="control-slider" 
                           min="0.01" max="1" step="0.01" value="0.5">
                </div>

                <!-- Visualization Spread Control -->
                <div class="labeled-control">
                    <label for="spread-slider">
                        Harmonic Spread 
                        <span id="spread-value">20%</span>
                    </label>
                    <input type="range" id="spread-slider" class="control-slider" 
                           min="0" max="1" step="0.01" value="0.2">
                </div>

                <!-- Visualization Frequency Control -->
                <div class="labeled-control">
                    <label for="viz-freq-slider">
                        Animation Speed 
                        <span id="viz-freq-value">2.0 Hz</span>
                    </label>
                    <input type="range" id="viz-freq-slider" class="control-slider" 
                           min="0.1" max="10" step="0.1" value="2.0">
                </div>
            </div>

            <!-- Fundamental & Waveform Controls Row -->
            <div class="control-row">
                <!-- Fundamental & Keyboard Group -->
                <div class="frequency-control-group">
                    <!-- Fundamental Frequency Control -->
                    <div class="labeled-control">
                        <label for="fundamental-input">
                            Fundamental Frequency 
                            <span class="fundamental-input-group">
                                <input type="number" id="fundamental-input" class="fundamental-input" 
                                       value="130.81" step="0.01"> Hz
                            </span>
                        </label>
                        
                        <!-- Octave Controls -->
                        <div class="octave-control">
                            <button id="octave-down" class="btn btn-octave">&lt; Octave Down</button>
                            <span id="current-octave-display" class="octave-display">Octave 3</span>
                            <button id="octave-up" class="btn btn-octave">Octave Up &gt;</button>
                        </div>
                        
                        <!-- Piano Keyboard -->
                        <div id="piano-keyboard" class="keyboard-container">
                             <!-- Keys will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Waveform Selector -->
                    <div class="labeled-control">
                         <label for="waveform-select">
                             Partial Waveform
                         </label>
                         <select id="waveform-select" class="control-select">
                             <option value="sine">Sine (Pure Additive)</option>
                             <option value="square">Square (Band-Limited)</option>
                             <option value="triangle">Triangle (Band-Limited)</option>
                             <option value="sawtooth">Sawtooth (Band-Limited)</option>
                         </select>
                    </div>
                </div>
            </div>

            <!-- System Selector & Subharmonic Toggle -->
            <div class="system-control-group">
                <div class="system-selector">
                    <label for="ratio-system-select">
                        Overtone System
                    </label>
                    <select id="ratio-system-select" class="control-select">
                        <!-- Options will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="subharmonic-toggle-container">
                    <span class="toggle-label overtone">Overtone (Multiply)</span>
                    <div id="subharmonic-toggle" class="toggle" role="switch" aria-checked="false"></div>
                    <span id="subharmonic-label" class="toggle-label inactive">Subharmonic (Divide)</span>
                </div>
                
                <div id="system-description" class="system-description"></div>
            </div>
            
            <p class="text-center text-sm text-gray mt-2">
                All complex waveforms (Square, Sawtooth, Triangle) are now **Band-Limited** for clean sound.
            </p>

            <!-- Drawbars -->
            <div id="drawbars" class="drawbar-container">
                <!-- Drawbars will be generated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Status Message Container -->
    <div id="status-message" class="status-message hidden"></div>

    <!-- Application Modules -->
    <script type="module" src="js/config.js"></script>
    <script type="module" src="js/momentum-smoother.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/audio.js"></script>
    <script type="module" src="js/visualization.js"></script>
    <script type="module" src="js/ui.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>